#+title: Code TODO
* [ ] Cleanup and optimizations
** [X] Autocompleters needs consts at model level
* [ ] Documentation
** [ ] Architecture
** [ ] Configuration
** [ ] Nodes
** [ ] Tools
** [ ] Know
** [ ] Preprocessors
** [ ] Hacking
* [ ] Preprocessors
** [ ] Figure out a way to print warnings or logs
* [ ] Runner
** [ ] [#A] Add a way to restrict number of loops when cycling
** [ ] Add a way to raise error and stop the runner. User should be able to try and continue the runner.
* [ ] Configuration
** [ ] Add a way to fully disable know
** [ ] Figure out why confirmation override for discovery did not work
** [ ] Tweak architect prompts to not provide solution if there are questions to answer or user explicitly requests one shot solution
** [ ] [#A] Tweak prompt for discovery to only work with existing files
** [ ] Rewrite system prompt for analyst node
Concrete example: files that were read and already in context.
* [ ] UI protocol
** [ ] Add syntax name hint to apply formatting
* [ ] [#A] Nested workflows support
** [ ] Create API to start a new workflow
- Should start a new runner with new state
- Wait for runner to finish
- Pass all messages through to UI, plumb via parent runner
- UIState should be smart enough to understand it's stacked execution. Need explicit messages to UIState on runner states, such as starting workflow execution, state changes, etc.
** [ ] Create a tool that allows LLMs to call into new workflows
** [ ] Create node that starts a workflow with an input
* [ ] Error handling
** [ ] Add exception handlers
*** [ ] Runner
*** [ ] UI
** [ ] Tool calling timeouts and failures
** [ ] Add a way for human to unblock failures by retrying last operation
** [ ] Running another workflow from workflow causes this error to be printed:
Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x131801dc0>
* [ ] Terminal UI
** [ ] Better visual separation of prompts vs responses
** [ ] When final message is printed, we need to add an extra linebreak. Also, validate streaming line splits with bottom toolbar - it seems to be broken.
** [ ] Disable know warnings, they mess up UI output
** [ ] Animation does not always start after providing feedback message back to Node
** [ ] Better multi-line inputs, don't require esc+enter to send
** [ ] Show how long individual steps took, in seconds
** [ ] Continue after stopping does not show agent output upon response, but it's there
** [ ] Simple styling
*** [ ] Simple animations
** [ ] Format tool calls
*** [ ] Add a way (tab?) to expand/collapse JSON
*** [ ] Require all tool calls from LLM to have description (Key Objective)
** [?] We might have deadlock somewhere that does not break with ctrl+c
- Added debugging stacktraces for now
** [ ] Fix estimated cost calculation
* [ ] Block parsers
** [ ] Diff parsers
*** [ ] Unified Diff format
* [ ] Nodes
** [ ] Add a node that injects files in context. Add file manager.
** [ ] LLM node
*** [ ] If call does not have correct payload that's not JSON - should respond back with an error immediately
Exception: Unable to convert openai tool calls={'role': 'assistant', 'content': "Of course. This is a classic state management and architectural problem. Let's analyze the three proposed approaches to creating stackable Runners.\n\nTo make the analysis more concrete, I will first search for the definitions of `Runner` and `UIState` to understand their current roles in the system.\n\n", 'tool_calls': [{'id': 'call_79eebc90de2b4b61ba97cc51bc7a', 'type': 'function', 'function': {'name': 'vectorops_search', 'arguments': '{"query": "Runner class", "kind": "class", "limit": 1}{"kind": "class", "query": "UIState class", "limit": 1}'}}]} to gemini tool calls. Received error=Extra data: line 1 column 55 (char 54)
*** [ ] Report tool token usage
*** [ ] Report % token usage
*** [ ] Add tool calling budgets (number of calls, tokens, etc)
*** [ ] Detect tool call loops
*** [ ] Add stats for the number of tokens in the context and context window limits
*** [ ] Figure out why pricing estimates are all zeroes
** [ ] Create RepoMap node - call into Know with provided prompt
*** [ ] Also create preprocessor
** [ ] Fan-out node - call other defined tools, collect their results and pass concatenated messages to next tool
** [ ] TODO node - collect plan that is formatted with specific syntax (markdown? function call?)
* [ ] Tools
** [ ] Integrate Know
*** [ ] Figure out how to express 3rd party dependencies and give access
*** [ ] Disable warnings
*** [ ] Add a way to fully disable know so project is not parsed.
** [ ] Add pattern matching rules to auto-approve rule calls
** [ ] Skills
*** [ ] Skill parsers
*** [ ] Generate tool stubs for skills
** [ ] Shell tool
*** [ ] Add timeout
*** [ ] Need comprehensive tests
*** [ ] Windows shell support
*** [ ] Non-POSIX shell support
*** [ ] PTY support
*** [ ] Containerization
*** [ ] Sandboxing
** [ ] Parallel tool calling support
** [ ] MCP tool support
*** [ ] Ensure that cwd is passed correctly
** [ ] Add a way to reject tool calling automatically if tools with same parameters were already called
** [ ] Figure out sandboxing
*** [ ] Wrap stdio MCP servers in sandbox
*** [ ] Wrap shell tool in sandbox
** [ ] Apply patch tool - useful for fully-agentic loops
